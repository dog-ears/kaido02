# 作業フロー

## 1. 作業開始

作業開始と言われたら、現在ステータスが未着手・進行中のタスク一覧を表示して、以下のいずれかを聞いてください：

- 既存のタスクに取り掛かる場合は、どれに取り掛かるか
- 新しくタスクを登録するか

**既存のタスクに取り掛かる場合**: 「4. タスク着手」に進んでください。

**新しくタスクを登録する場合**: 「2. 計画」に進んでください。

## 2. 計画

新しくタスクを登録する場合、まず plan モードで作業内容を決定してください。

計画には以下を含めてください：

- 実装する機能の概要
- 使用する技術・ライブラリ
- 実装手順
- 確認事項（必要に応じて）

## 3. 新しいタスクの登録

計画が確定したら、その内容を Notion に新しいタスクとして登録してください。

タスクには以下を含めてください：

- タスク名（計画内容を要約）
- 計画の詳細内容（ページ内に記載）

Notion タスクの登録は、`.ai/rule.md`の Notion 操作に関するルールに従って、モデルを推奨モデルに切り替えてから実行してください。

タスク登録後、「このタスクにこのまま取り掛かりますか？」と確認してください。

取り掛かる場合は、次の「4. タスク着手」に進んでください。

取り掛からない場合は、ここで作業を終了してください。

## 4. タスク着手

既存のタスクに取り掛かる場合、または新規タスク登録後に取り掛かる場合、タスクのステータスを進行中にしてください。

## 5. ブランチ作成

main ブランチから新しいブランチを作成してください。

新しいブランチの命名ルールは、`tasks/[タスクのID]` です。

例: タスク ID が 11 の場合、`tasks/11`

## 6. 作業

タスクの作業を行います。

## 7. コミット

作業が終わったら、コミットします。

コミットメッセージのつけ方は以下のルールとします。

```
【[タスクのID]】[プレフィックス]: [修正内容]
```

例: `【11】docs: 作業フロー追加`

コミットは、.ai 関連、docs 関連、それ以外を別々にコミットしてください。

- .ai 関連のときは「ai_rule」をプレフィックスとして使用
- docs 関連のときは「docs」をプレフィックスとして使用
- それ以外のときはプレフィックスと直後の「: 」は不要です。

## 8. プッシュ

ブランチをリモートリポジトリにプッシュします。

```bash
git push origin tasks/[タスクのID]
```

例: `git push origin tasks/11`

## 9. プルリクエスト作成

GitHub CLI を使用してプルリクエストを作成します。

プルリクエストの本文には、Notion のタスク名と URL を記載してください。

```bash
gh pr create --title "【[タスクのID]】[タイトル]" --body "Notionタスク：[タスク名]

[タスクのURL]

[説明]"
```

例:

```bash
gh pr create --title "【11】作業フロー追加" --body "Notionタスク：作業の一連の流れを決めてルール化する

https://www.notion.so/2a9829eddd48805cb6eec539b60d2388

作業フロードキュメントを追加しました"
```

プルリクエスト作成後、Vercel のプレビューデプロイが自動的に作成され、プルリクエストにコメントが追加されます。

プレビュー URL の形式: `https://[プロジェクト名]-git-[ブランチ名]-[ユーザー名]-projects.vercel.app`

例: `https://kaido02-git-tasks-11-dogears-projects.vercel.app/`

## 10. Notion タスクに PR URL を追加・ステータスを検証中に変更

プルリクエスト作成後、以下の 2 つを実行してください。

1. 作成されたプルリクエストの URL を Notion タスクの「PR URL」プロパティに追加
2. タスクのステータスを「検証中」に変更

プルリクエストの URL は、`gh pr create`コマンドの実行結果に表示されます。

例: `https://github.com/dog-ears/kaido02/pull/1`

Notion タスクの更新は、`.ai/rule.md`の Notion 操作に関するルールに従って、モデルを推奨モデルに切り替えてから実行してください。

## 11. プルリクエストのマージ

**この作業は作業者が行います。**

プルリクエストのレビューが完了したら、作業者がマージを実行してください。

マージ方法は **Create a merge commit** を使用してください。

この方法では、すべてのコミット履歴が保持され、マージコミットが作成されます。

マージが完了したら、作業者は完了を報告してください。

## 12. 作業完了のクリーンアップ

マージ完了の報告を受けたら、以下のクリーンアップを実行してください：

1. **mainブランチに切り替え**
   ```bash
   git checkout main
   ```

2. **最新の変更を取得**
   ```bash
   git pull origin main
   ```

3. **作業ブランチを削除**
   ```bash
   git branch -d tasks/[タスクのID]
   ```

   例: `git branch -d tasks/11`

これにより、ローカル環境がクリーンな状態に保たれます。
