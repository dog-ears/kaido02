[README](../README.md) / 作業フロー

# 作業フロー

## 1. 計画

新しくタスクを登録する場合、まず plan モードで作業内容を決定してください。

計画には以下を含めてください：

- 実装する機能の概要
- 使用する技術・ライブラリ
- 実装手順
- 確認事項（必要に応じて）

計画が固まりビルドが開始されたら、必ず「2. 新しいタスクの登録」以降の手順に従って作業を進めてください。

## 2. 新しいタスクの登録

計画が確定したら、その内容を Notion に新しいタスクとして登録してください。

### Notion タスク DB 情報

- データベース ID: `2a4829eddd488038b655c5cd5ef77030`
- データソース URL: `collection://2a4829ed-dd48-8040-9587-000b74a6a2d1`

Notion 操作を行う前に、このセクションを参照して正しいデータベースに対して処理するようにしてください。

タスクには以下を含めてください：

- タスク名（計画内容を要約）
- 計画の詳細内容（ページ内に記載）

Notion タスクの登録は、`.ai/rule.md`の Notion 操作に関するルールに従って、モデルを推奨モデルに切り替えてから実行してください。

タスク登録時はすぐに取り掛かるため、ステータスを必ず「進行中」に設定してください。

## 3. ブランチ作成

main ブランチから新しいブランチを作成してください。

新しいブランチの命名ルールは、`tasks/[タスクのID]` です。

例: タスク ID が 11 の場合、`tasks/11`

## 4. 作業

タスクの作業を行います。作業が完了したら、完了内容を報告し、問題ないか確認を取ってから次のステップへ進んでください。

## 5. コミット

作業が終わったら、コミットします。

コミットメッセージのつけ方は以下のルールとします。

```
【[タスクのID]】[プレフィックス]: [修正内容]
```

例: `【11】docs: 作業フロー追加`

コミットは、.ai 関連、docs 関連、それ以外を別々にコミットしてください。

- .ai 関連のときは「ai_rule」をプレフィックスとして使用
- docs 関連のときは「docs」をプレフィックスとして使用
- それ以外のときはプレフィックスと直後の「: 」は不要です。

## 6. プッシュ

ブランチをリモートリポジトリにプッシュします。

```bash
git push origin tasks/[タスクのID]
```

例: `git push origin tasks/11`

## 7. プルリクエスト作成

GitHub CLI を使用してプルリクエストを作成します。すでに対象タスクの PR が存在する場合は、このステップをスキップしてかまいません。

プルリクエストの本文には、Notion のタスク名と URL を記載してください。

```bash
gh pr create --title "【[タスクのID]】[タイトル]" --body "Notionタスク：[タスク名]

[タスクのURL]

[説明]"
```

例:

```bash
gh pr create --title "【11】作業フロー追加" --body "Notionタスク：作業の一連の流れを決めてルール化する

https://www.notion.so/2a9829eddd48805cb6eec539b60d2388

作業フロードキュメントを追加しました"
```

プルリクエスト作成後、Vercel のプレビューデプロイが自動的に作成され、プルリクエストにコメントが追加されます。

プレビュー URL の形式: `https://[プロジェクト名]-git-[ブランチ名]-[ユーザー名]-projects.vercel.app`

例: `https://kaido02-git-tasks-11-dogears-projects.vercel.app/`

## 8. Notion タスクに PR URL を追加・ステータスを検証中に変更

プルリクエスト作成後、以下の 2 つを実行してください。

1. 作成されたプルリクエストの URL を Notion タスクの「PR URL」プロパティに追加
2. タスクのステータスを「検証中」に変更

プルリクエストの URL は、`gh pr create`コマンドの実行結果に表示されます。

例: `https://github.com/dog-ears/kaido02/pull/1`

Notion タスクの更新は、`.ai/rule.md`の Notion 操作に関するルールに従って、モデルを推奨モデルに切り替えてから実行してください。

## 9. プルリクエストのマージ

**この作業は作業者が行います。**

プルリクエストのレビューが完了したら、作業者がマージを実行してください。

マージ方法は **Create a merge commit** を使用してください。

この方法では、すべてのコミット履歴が保持され、マージコミットが作成されます。

マージが完了したら、作業者は完了を報告してください。

## 10. 作業完了のクリーンアップ

マージ完了の報告を受けたら、以下のクリーンアップを実行してください：

1. **main ブランチに切り替え**

   ```bash
   git checkout main
   ```

2. **最新の変更を取得**

   ```bash
   git pull origin main
   ```

3. **作業ブランチを削除**

   ```bash
   git branch -d tasks/[タスクのID]
   ```

   例: `git branch -d tasks/11`

これにより、ローカル環境がクリーンな状態に保たれます。
